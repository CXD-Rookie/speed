<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录页面</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <style>
      body, html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0; /* 背景颜色，和登录框背景对比 */
        }

        .login-container {
            text-align: center;
            padding: 20px;
            width: 320px;
            height: 376px;
            background: #3e3e4a;
            border-radius: 10px;
            box-shadow: 0px 0px 30px 0px rgba(0, 0, 0, 0.50);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .logo {
            text-align: center; /* 居中对齐 */
        }

        .logo img {
            max-width: 100%; /* 确保图片自适应容器宽度 */
            width: 33px;
            height: 40px;
        }

        .login-box .logo {
            width: 50px;  /* Assuming logo is square */
            border-radius: 50%;  /* Make it circular */
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
        }

        h2 {
            margin: 20px 0;  /* Add margin to create space between logo and input fields */
            text-align: left;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 10px 10px 10px 40px;
            border: none;
            border-radius: 4px;
            box-sizing: border-box;
            background: #2c2f33;
            color: white;
            height: 45px;
            padding-left: 85px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.07);
        }

        .input-group .country-code {
            position: absolute;
            left: 40px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;  /* Make the country code non-interactive */
        }

        .input-group button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: transparent;
            border: none;
            color: #ff6f00;
            cursor: pointer;
        }

        .input-group .icon-phone,
        .input-group .icon-lock {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: #999;
            width: 18px;
            height: 18px;
        }

        .icon-phone::before {
            content: "\f10b"; /* FontAwesome unicode for phone icon */
            font-family: "FontAwesome";
        }

        .icon-lock::before {
            content: "\f023"; /* FontAwesome unicode for lock icon */
            font-family: "FontAwesome";
        }

        #login {
            width: 100%;
            padding: 10px;
            background-color: #ff6f00;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            margin-top: 20px;
            height: 44px;
            background: #f86c34;
            border-radius: 22px;
        }

        #login:disabled {
            background-color: #999;  /* Change background color when button is disabled */
        }

    </style>
</head>

<body>
    <div class="login-container">
        <div class="login-box">
            <div class="close-btn" id="close-btn">&times;</div>
            <div class="logo">
                <img src="https://jsq-web.oss-cn-beijing.aliyuncs.com/web/assets/login.png" alt="Logo">
            </div>            
            <h2>请登录</h2>
            <div class="input-group">
                <img src="https://tc-js.yuwenlong.cn/static/media/phone.ab4358464532095bb80e1698f890aa52.svg" class="icon-phone"></img>
                <span class="country-code">+86</span>
                <input type="text" id="phone" placeholder="请输入手机号">
            </div>
            <div class="input-group">
                <img src="	https://tc-js.yuwenlong.cn/static/media/challenge.da21dac7be2bca116aefe8be10985a96.svg" class="icon-lock"></img>
                <input type="text" id="verification-code" placeholder="请输入验证码">
                <button id="send-code">发送验证码</button>
                <div id="captcha-element"></div>
            </div>
            <button id="login">登录</button>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://o.alicdn.com/captcha-frontend/aliyunCaptcha/AliyunCaptcha.js"></script>
    <script>
        $(document).ready(function () {
            // 在页面加载时设置全局的 AJAX 默认选项
            $.ajaxSetup({
                headers: {
                    'client_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjbGllbnRfaWQiOiJyZGZnc2RmLWFtZmhmdC1tZm1lcnRhYS1hZGZhZGZnZHMtZ2Rmc2dmIiwiY2xpZW50X2lwIjoiMTI3LjAuMC4xIiwiZXhwIjoxNzE4NDQzMjE1fQ.Ww-OhE8HAxjrMIjPmwA5UEXBt_wjEARwA1aNQ0UEG58',
                    'client_id': 'rdfgsdf-amfhft-mfmertaa-adfadfgds-gdfsgf',
                    'user_token': "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXIiOiIiLCJjbGllbnRfaWQiOiJyZGZnc2RmLWFtZmhmdC1tZm1lcnRhYS1hZGZhZGZnZHMtZ2Rmc2dmIiwiY3JlYXRlX3RpbWUiOjE3MTU1ODg2NTUsImV4cCI6MTcxODQ0MzQzNywiaWQiOiI2NjQxY2UyZjFkY2EyOGExNjdmN2U5M2YiLCJsb2dpbl9pcCI6IjEyNy4wLjAuMSIsIm5pY2tuYW1lIjoi5bm75oOz5bel56iL5aWH5omNIiwicGhvbmUiOiI4ZjBmM2M1YTdmMTJmYmE2MTMxMWE4ZDBmNDBjNjY3NSIsInBsYXRmb3JtIjoiV2luZG93cyIsInVwZGF0ZV90aW1lIjoxNzE1ODUxNDM3fQ.OMLHSklc9NVwW0FdM9LfR4yMACn_6oGvRWSdTHLT4hc"
                }
            });
            let captcha;
            // 绑定验证码实例函数
            function getInstance(instance) {
                console.log(999999999999)
                captcha = instance;
            }
            var urlPrefix = "https://rm-mga-dev.yuwenlong.cn/api/v1"

            // 验证码验证回调函数
            async function captchaVerifyCallback(captchaVerifyParam) {
                console.log(888888888888888)
                const phone = $('#phone').val();
                // const urlPrefix = window.location.origin;
                const url = `${urlPrefix}/send_sms/${phone}`;
                const scene_id = 1; // 这里用你提供的默认值，你也可以根据需求自行设置
                // 发送验证码请求
                const result = await $.ajax({
                    url: url,
                    method: 'POST',
                    contentType: 'application/json', // 设置请求头为 JSON
                    data: JSON.stringify({
                        scene_id: scene_id,
                        captcha_verify_param: captchaVerifyParam
                    })
                });
                console.log("result--------------------------",result)
                if (result.error === 0) {
                    return {
                        captchaResult: true,
                        bizResult: true,
                    };
                }
            }



            // 业务验证结果回调函数
            function onBizResultCallback(bizResult) {
                console.log(666666666666)
                if (bizResult) {
                    alert('验证码发送成功');
                    startCountdown();
                } else {
                    alert('验证码发送失败，请重试');
                }
            }

            // 手机号验证函数
            function validatePhone(phone) {
                const phoneRegex = /^1[3-9]\d{9}$/; // 适用于中国大陆手机号的正则表达式
                return phoneRegex.test(phone);
            }
            // 倒计时函数
            function startCountdown() {
                var countdown = 120;
                $('#send-code').attr('disabled', true).text(countdown + 's');
                var timer = setInterval(function () {
                    countdown--;
                    $('#send-code').text(countdown + 's');
                    if (countdown === 0) {
                        clearInterval(timer);
                        $('#send-code').attr('disabled', false).text('发送验证码');
                    }
                }, 1000);
            }

            $('#send-code').click(function () {
                console.log(22222222222)
                const phone = $('#phone').val();
                if (phone === '') {
                    alert('请输入手机号');
                    return;
                }
                if (!validatePhone(phone)) {
                    alert('请输入有效的手机号');
                    return;
                }
                console.log(11111111111)
                // 只有当手机号验证通过时才触发阿里云验证码
              
                initAliyunCaptcha({
                    SceneId: '1wdbgbcu',
                    prefix: 'o1604o',
                    mode: 'popup',
                    element: '#captcha-element',
                    button: '#send-code',
                    captchaVerifyCallback: captchaVerifyCallback,
                    onBizResultCallback: onBizResultCallback,
                    getInstance: function (instance) {
                        captcha = instance;
                        captcha.show(); // 验证码实例初始化完成后再显示验证码
                    },
                    slideStyle: {
                        width: 360,
                        height: 40,
                    },
                    language: 'cn',
                    region: 'cn'
                });
            });
            $('#login').click(function () {
                const phone = $('#phone').val();
                const verificationCode = $('#verification-code').val();

                if (phone === '' || verificationCode === '') {
                    alert('请输入手机号和验证码');
                    return;
                }
                if (!validatePhone(phone)) {
                    alert('请输入有效的手机号');
                    return;
                }

                // 发送登录请求
                $.ajax({
                    url: `${urlPrefix}/login_phone_code`,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        phone: phone,
                        verificationCode: verificationCode,
                        platform: 1,
                    }),
                    success: function (response) {
                        console.log("====================",response)
                        if (response.erroe === 0) {
                            alert('登录成功');
                            // 处理登录成功逻辑
                        } else {
                            alert('登录失败，请重试');
                        }
                    },
                    error: function () {
                        alert('登录失败，请重试11111111');
                    }
                });
            });

            $('#close-btn').click(function () {
                // 关闭登录框逻辑，根据实际情况编写
                $('.login-container').hide();
            });
        });

    </script>
    <!-- <script>
        $(document).ready(function () {
            var countdown = 120;
            var timer;

            function startCountdown() {
                $('#send-code').attr('disabled', true).text(countdown + 's');
                timer = setInterval(function () {
                    countdown--;
                    $('#send-code').text(countdown + 's');
                    if (countdown === 0) {
                        clearInterval(timer);
                        $('#send-code').attr('disabled', false).text('发送验证码');
                        countdown = 120;
                    }
                }, 1000);
            }

            $('#send-code').click(function () {
                var phone = $('#phone').val();
                if (phone === '') {
                    alert('请输入手机号');
                    return;
                }

                new AliyunCaptcha({
                    "appid": "your-app-id",
                    "scene": "your-scene",
                    "success": function (captchaData) {
                        $.ajax({
                            url: 'https://your-server-api/send-verification-code',
                            method: 'POST',
                            data: {
                                phone: phone,
                                captcha: captchaData
                            },
                            success: function (response) {
                                if (response.success) {
                                    startCountdown();
                                } else {
                                    alert('验证码发送失败，请重试');
                                }
                            },
                            error: function () {
                                alert('验证码发送失败，请重试');
                            }
                        });
                    }
                }).show();
            });

            $('#login').click(function () {
                var phone = $('#phone').val();
                var verificationCode = $('#verification-code').val();
                if (phone === '' || verificationCode === '') {
                    alert('请输入手机号和验证码');
                    return;
                }

                $.ajax({
                    url: 'https://your-server-api/login',
                    method: 'POST',
                    data: {
                        phone: phone,
                        verificationCode: verificationCode
                    },
                    success: function (response) {
                        if (response.success) {
                            alert('登录成功');
                            // 处理登录成功逻辑
                        } else {
                            alert('登录失败，请重试');
                        }
                    },
                    error: function () {
                        alert('登录失败，请重试');
                    }
                });
            });

            $('#close-btn').click(function () {
                // 关闭登录框逻辑，根据实际情况编写
                $('.login-container').hide();
            });
        });
    </script> -->
</body>

</html>