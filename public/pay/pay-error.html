<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        position: relative;
        min-height: 100vh;
        margin: 0;
      }

      .pay-error img {
        position: absolute;
        top: 27%;
        left: 50%;
        transform: translateX(-50%);
      }

      .pay-error .pay-error-text1 {
        position: absolute;
        top: calc(41%);
        left: 50%;
        font-size: 16px;
        color: #999;
        transform: translateX(-50%);
      }

      .pay-error .pay-error-text2 {
        position: absolute;
        top: calc(41% + 22px);
        left: 50%;
        font-size: 16px;
        color: #999;
        transform: translateX(-50%);
      }
    </style>
  </head>
  <body>
    <div class="pay-error">
      <img src="./image/error.png" width="80" height="80" alt="" />
      <div class="pay-error-text1">支付失败</div>
      <div class="pay-error-text2">请重新扫码支付</div>
    </div>
  </body>
  <script>
    // ============== 统一关闭逻辑 ==============
    function closeWindow() {
      // 微信环境优先调用原生关闭
      if (typeof WeixinJSBridge !== 'undefined') {
        WeixinJSBridge.invoke('closeWindow', {}, function(res) {
          // 关闭失败时降级处理
          if (res.err_msg !== 'closeWindow:ok') {
            location.href = 'about:blank'
            window.close()
          }
        }, false)
      }
    }

    // ============== 事件绑定 ==============
    // 监听所有可能的返回方式
    window.addEventListener('popstate', closeWindow)
    
    // 处理Android物理返回键
    document.addEventListener('backbutton', closeWindow, false)
    
    // 处理iOS右滑返回（额外添加触摸检测）
    let touchStartX = 0
    document.addEventListener('touchstart', e => {
      touchStartX = e.touches[0].clientX
    })
    document.addEventListener('touchend', e => {
      const deltaX = e.changedTouches[0].clientX - touchStartX
      if (deltaX > 60) closeWindow()
    })

    // ============== 微信环境优化 ==============
    // 确保JSBridge加载完成
    if (/MicroMessenger/i.test(navigator.userAgent)) {
      document.addEventListener('WeixinJSBridgeReady', closeWindow, false)
    }
  </script>
</html>
